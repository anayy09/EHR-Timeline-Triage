# EHR Timeline Triage

**⚠️ RESEARCH PROTOTYPE ONLY - NOT FOR CLINICAL USE ⚠️**

This project is a research prototype for educational and demonstration purposes only. It is **NOT** intended for clinical decision-making or patient care. All predictions and explanations are generated by machine learning models trained on synthetic or deidentified data and should not be used to inform medical decisions.

## Overview

EHR Timeline Triage is an open-source project that converts longitudinal Electronic Health Record (EHR) data from hospital stays into structured timelines and generates risk predictions with human-readable explanations. The system supports two critical prediction tasks:

1. **30-Day Readmission Risk**: Predicts whether a patient will be readmitted within 30 days of discharge
2. **48-Hour ICU Mortality Risk**: Predicts in-hospital mortality risk after the first 48 hours of ICU admission

The project demonstrates how temporal sequence modeling (GRU, Transformer) can capture clinical trajectories alongside traditional baseline models (Logistic Regression). Each prediction includes interpretable explanations that reference specific time periods and clinical signals.

## Features

- **Timeline Construction**: Converts raw EHR events into structured timelines with configurable time bins
- **Multiple Model Types**: Baseline (Logistic Regression) and sequence models (GRU, Transformer)
- **Interpretability**: Attribution methods and natural language explanations for predictions
- **REST API**: FastAPI backend for serving predictions
- **Web Dashboard**: Interactive UI for exploring patient timelines and risk predictions
- **Synthetic Data Generation**: Built-in synthetic EHR data generator for demonstration
- **Comprehensive Evaluation**: AUROC, AUPRC, Brier score, calibration metrics, and plots

## Architecture

```
┌─────────────────┐
│   Raw EHR Data  │
│  (Synthetic or  │
│     MIMIC-IV)   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Cohort Builder │
│  - Readmission  │
│  - ICU Mortality│
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│Feature Engineer │
│  - Snapshot     │
│  - Sequence     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Model Training │
│  - Baselines    │
│  - Sequence     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   FastAPI       │
│   Backend       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  React/Next.js  │
│   Frontend      │
└─────────────────┘
```

## Quick Start

### Prerequisites

- Python 3.11+
- Node.js 18+ (for frontend)
- Docker and Docker Compose (optional)

### Installation

1. **Clone the repository**:
   ```bash
   git clone https://github.com/yourusername/ehr-timeline-triage.git
   cd ehr-timeline-triage
   ```

2. **Set up Python environment**:
   ```bash
   python -m venv venv
   venv\Scripts\activate  # Windows
   # source venv/bin/activate  # Linux/Mac
   pip install -r requirements.txt
   ```

3. **Generate synthetic data**:
   ```bash
   python -m ehrtriage.scripts.generate_synthetic
   ```

4. **Train models**:
   ```bash
   python -m ehrtriage.scripts.train_all
   ```

5. **Start the API server**:
   ```bash
   uvicorn api.app:app --reload
   ```

6. **Start the frontend** (in a new terminal):
   ```bash
   cd web
   npm install
   npm run dev
   ```

7. **Access the application**:
   - Frontend: http://localhost:3000
   - API docs: http://localhost:8000/docs

### Using Docker

```bash
docker-compose up --build
```

## Datasets

### Synthetic Data (Default)

This project ships with a synthetic data generator that creates realistic EHR-like events including:
- Admissions and ICU stays with timestamps
- Vitals (HR, BP, RR, SpO2, Temperature)
- Labs (Lactate, Creatinine, WBC, etc.)
- Medications (Vasopressors, Antibiotics)
- Static demographics (Age, Sex, Comorbidities)

The synthetic data follows documented schema rules and includes realistic patterns for generating outcome labels.

### MIMIC-IV (Optional)

If you have access to MIMIC-IV, you can use real deidentified data:

1. Request access at https://physionet.org/content/mimiciv/
2. Download and place files in `data/raw/`
3. Configure paths in `configs/data.yml`
4. Run cohort building scripts

**Note**: This repository does NOT include any MIMIC-IV data. You must obtain it separately following PhysioNet's requirements.

## Project Structure

```
ehr-timeline-triage/
├── ehrtriage/           # Core Python package
│   ├── cohort.py        # Cohort definitions
│   ├── features.py      # Feature engineering
│   ├── sequence_builder.py
│   ├── models/          # ML models
│   ├── explain/         # Interpretability
│   └── evaluation/      # Metrics and plots
├── api/                 # FastAPI backend
├── web/                 # React frontend
├── data/                # Data directories
├── notebooks/           # Exploration notebooks
├── tests/               # Unit tests
├── docs/                # Documentation
└── configs/             # Configuration files
```

## Documentation

- [System Design](docs/system_design.md)
- [Data Pipeline](docs/data_pipeline.md)
- [Models](docs/models.md)
- [Interpretability](docs/interpretability.md)
- [Limitations](docs/limitations.md)

## Testing

```bash
pytest
```

## Contributing

Contributions are welcome! Please:
1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Ensure all tests pass
5. Submit a pull request

## License

MIT License - see LICENSE file for details

## Citation

If you use this project in your research, please cite:

```bibtex
@software{ehr_timeline_triage,
  title={EHR Timeline Triage: Temporal Risk Prediction with Interpretability},
  author={Your Name},
  year={2025},
  url={https://github.com/yourusername/ehr-timeline-triage}
}
```

## Disclaimer

**THIS SOFTWARE IS FOR RESEARCH AND EDUCATIONAL PURPOSES ONLY.**

This is a research prototype and demonstration tool. It is NOT validated for clinical use and should NOT be used for:
- Making clinical decisions
- Diagnosing patients
- Determining treatment plans
- Any patient care activities

The models are trained on synthetic or deidentified data and may not generalize to real clinical settings. No warranty or guarantee of accuracy is provided. Always consult qualified healthcare professionals for medical decisions.
